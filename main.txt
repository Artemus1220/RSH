local SG = Instance.new("ScreenGui")
SG.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
SG.Name = "RSH"
SG.ResetOnSpawn = false

-- Основной фрейм
local F = Instance.new("Frame")
F.Size = UDim2.new(0, 1000, 0, 700) -- Увеличили высоту для новых элементов
F.Position = UDim2.new(0.5, 0, 0.5, 0)
F.AnchorPoint = Vector2.new(0.5, 0.5)
F.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
F.BackgroundTransparency = 0.1
F.BorderSizePixel = 0
F.Parent = SG

-- Кнопка закрытия/открытия
local ToggleButton = Instance.new("TextButton")
ToggleButton.Name = "ToggleButton"
ToggleButton.Text = "X"
ToggleButton.TextColor3 = Color3.new(1, 1, 1)
ToggleButton.TextSize = 18
ToggleButton.Size = UDim2.new(0, 40, 0, 40)
ToggleButton.Position = UDim2.new(1, -50, 0, 10)
ToggleButton.AnchorPoint = Vector2.new(1, 0)
ToggleButton.BackgroundColor3 = Color3.fromRGB(255, 60, 60)
ToggleButton.BorderSizePixel = 0
ToggleButton.AutoButtonColor = false
ToggleButton.Parent = SG

-- Заголовок
local Title = Instance.new("TextLabel")
Title.Text = "Roblox Studio Hack"
Title.TextColor3 = Color3.new(1, 1, 1)
Title.Size = UDim2.new(1, -100, 0, 50)
Title.Position = UDim2.new(0, 50, 0, 0)
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.BackgroundTransparency = 1
Title.Font = Enum.Font.GothamBold
Title.TextSize = 22
Title.Parent = F

-- Кнопка полёта
local FlyButton = Instance.new("TextButton")
FlyButton.Text = "ВКЛЮЧИТЬ ПОЛЁТ"
FlyButton.TextColor3 = Color3.new(1, 1, 1)
FlyButton.Size = UDim2.new(0, 300, 0, 60)
FlyButton.Position = UDim2.new(0.3, -150, 0.15, -30)
FlyButton.AnchorPoint = Vector2.new(0.5, 0.5)
FlyButton.BackgroundColor3 = Color3.fromRGB(80, 80, 255)
FlyButton.BorderSizePixel = 0
FlyButton.TextSize = 18
FlyButton.Font = Enum.Font.GothamBold
FlyButton.Parent = F

-- Фрейм управления скоростью
local SpeedFrame = Instance.new("Frame")
SpeedFrame.Size = UDim2.new(0, 300, 0, 80)
SpeedFrame.Position = UDim2.new(0.3, -150, 0.3, -30)
SpeedFrame.AnchorPoint = Vector2.new(0.5, 0.5)
SpeedFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
SpeedFrame.BorderSizePixel = 0
SpeedFrame.Parent = F

local SpeedLabel = Instance.new("TextLabel")
SpeedLabel.Text = "Скорость полёта:"
SpeedLabel.TextColor3 = Color3.new(1, 1, 1)
SpeedLabel.Size = UDim2.new(1, -20, 0, 20)
SpeedLabel.Position = UDim2.new(0, 10, 0, 5)
SpeedLabel.TextXAlignment = Enum.TextXAlignment.Left
SpeedLabel.BackgroundTransparency = 1
SpeedLabel.Font = Enum.Font.Gotham
SpeedLabel.TextSize = 14
SpeedLabel.Parent = SpeedFrame

local SpeedBox = Instance.new("TextBox")
SpeedBox.PlaceholderText = "Текущая: 50"
SpeedBox.Text = "50"
SpeedBox.Size = UDim2.new(0.6, -10, 0, 25)
SpeedBox.Position = UDim2.new(0, 5, 0, 30)
SpeedBox.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
SpeedBox.TextColor3 = Color3.new(1, 1, 1)
SpeedBox.Parent = SpeedFrame

local ApplySpeedButton = Instance.new("TextButton")
ApplySpeedButton.Text = "Применить"
ApplySpeedButton.TextColor3 = Color3.new(1, 1, 1)
ApplySpeedButton.Size = UDim2.new(0.35, -10, 0, 25)
ApplySpeedButton.Position = UDim2.new(0.65, 5, 0, 30)
ApplySpeedButton.BackgroundColor3 = Color3.fromRGB(80, 80, 255)
ApplySpeedButton.BorderSizePixel = 0
ApplySpeedButton.TextSize = 14
ApplySpeedButton.Parent = SpeedFrame

-- Кнопка подсветки игроков
local HighlightButton = Instance.new("TextButton")
HighlightButton.Text = "ПОДСВЕТКА ИГРОКОВ"
HighlightButton.TextColor3 = Color3.new(1, 1, 1)
HighlightButton.Size = UDim2.new(0, 300, 0, 60)
HighlightButton.Position = UDim2.new(0.3, -150, 0.45, -30)
HighlightButton.AnchorPoint = Vector2.new(0.5, 0.5)
HighlightButton.BackgroundColor3 = Color3.fromRGB(255, 80, 80)
HighlightButton.BorderSizePixel = 0
HighlightButton.TextSize = 18
HighlightButton.Font = Enum.Font.GothamBold
HighlightButton.Parent = F

-- Кнопка NoClip
local NoClipButton = Instance.new("TextButton")
NoClipButton.Text = "ВКЛЮЧИТЬ NOCLIP"
NoClipButton.TextColor3 = Color3.new(1, 1, 1)
NoClipButton.Size = UDim2.new(0, 300, 0, 60)
NoClipButton.Position = UDim2.new(0.3, -150, 0.6, -30)
NoClipButton.AnchorPoint = Vector2.new(0.5, 0.5)
NoClipButton.BackgroundColor3 = Color3.fromRGB(150, 50, 150)
NoClipButton.BorderSizePixel = 0
NoClipButton.TextSize = 18
NoClipButton.Font = Enum.Font.GothamBold
NoClipButton.Parent = F

-- Поле для ввода цвета
local ColorInputFrame = Instance.new("Frame")
ColorInputFrame.Size = UDim2.new(0, 300, 0, 100)
ColorInputFrame.Position = UDim2.new(0.3, -150, 0.75, -50)
ColorInputFrame.AnchorPoint = Vector2.new(0.5, 0.5)
ColorInputFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
ColorInputFrame.BorderSizePixel = 0
ColorInputFrame.Parent = F

local ColorLabel = Instance.new("TextLabel")
ColorLabel.Text = "RGB цвет (0-255):"
ColorLabel.TextColor3 = Color3.new(1, 1, 1)
ColorLabel.Size = UDim2.new(1, -20, 0, 20)
ColorLabel.Position = UDim2.new(0, 10, 0, 5)
ColorLabel.TextXAlignment = Enum.TextXAlignment.Left
ColorLabel.BackgroundTransparency = 1
ColorLabel.Font = Enum.Font.Gotham
ColorLabel.TextSize = 14
ColorLabel.Parent = ColorInputFrame

local RBox = Instance.new("TextBox")
RBox.PlaceholderText = "R (красный)"
RBox.Size = UDim2.new(0.3, -10, 0, 25)
RBox.Position = UDim2.new(0, 5, 0, 30)
RBox.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
RBox.TextColor3 = Color3.new(1, 1, 1)
RBox.Parent = ColorInputFrame

local GBox = Instance.new("TextBox")
GBox.PlaceholderText = "G (зеленый)"
GBox.Size = UDim2.new(0.3, -10, 0, 25)
GBox.Position = UDim2.new(0.35, 0, 0, 30)
GBox.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
GBox.TextColor3 = Color3.new(1, 1, 1)
GBox.Parent = ColorInputFrame

local BBox = Instance.new("TextBox")
BBox.PlaceholderText = "B (синий)"
BBox.Size = UDim2.new(0.3, -10, 0, 25)
BBox.Position = UDim2.new(0.7, 0, 0, 30)
BBox.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
BBox.TextColor3 = Color3.new(1, 1, 1)
BBox.Parent = ColorInputFrame

local ApplyColorButton = Instance.new("TextButton")
ApplyColorButton.Text = "Применить цвет"
ApplyColorButton.TextColor3 = Color3.new(1, 1, 1)
ApplyColorButton.Size = UDim2.new(1, -20, 0, 25)
ApplyColorButton.Position = UDim2.new(0, 10, 0, 65)
ApplyColorButton.BackgroundColor3 = Color3.fromRGB(80, 80, 255)
ApplyColorButton.BorderSizePixel = 0
ApplyColorButton.TextSize = 14
ApplyColorButton.Parent = ColorInputFrame

-- Переменные для управления
local isVisible = true
local isFlying = false
local isHighlighting = false
local isNoClip = false
local flySpeed = 50
local bodyGyro, bodyVelocity
local highlights = {}
local highlightColor = Color3.fromRGB(255, 50, 50)
local connections = {}

-- Функция для уведомлений
local function ShowNotification(text)
    local Notification = Instance.new("TextLabel")
    Notification.Text = text
    Notification.TextColor3 = Color3.new(1, 1, 1)
    Notification.Size = UDim2.new(0, 300, 0, 60)
    Notification.Position = UDim2.new(1, -320, 1, -80)
    Notification.AnchorPoint = Vector2.new(1, 1)
    Notification.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    Notification.BackgroundTransparency = 0.3
    Notification.BorderSizePixel = 0
    Notification.TextSize = 16
    Notification.Font = Enum.Font.Gotham
    Notification.Parent = SG
    
    Notification.Size = UDim2.new(0, 0, 0, 60)
    Notification:TweenSize(UDim2.new(0, 300, 0, 60), "Out", "Quad", 0.3)
    
    delay(3, function()
        Notification:TweenSize(UDim2.new(0, 0, 0, 60), "Out", "Quad", 0.3, true, function()
            Notification:Destroy()
        end)
    end)
end

-- Функция переключения видимости
ToggleButton.MouseButton1Click:Connect(function()
    isVisible = not isVisible
    F.Visible = isVisible
    ShowNotification(isVisible and "Меню открыто" or "Меню закрыто")
end)

-- Функция полёта
local function ToggleFlight()
    local character = game.Players.LocalPlayer.Character
    if not character then return end
    
    local humanoid = character:FindFirstChild("Humanoid")
    local rootPart = character:FindFirstChild("HumanoidRootPart")
    if not humanoid or not rootPart then return end
    
    if not isFlying then
        humanoid.PlatformStand = true
        
        bodyGyro = Instance.new("BodyGyro")
        bodyGyro.P = 10000
        bodyGyro.MaxTorque = Vector3.new(10000, 10000, 10000)
        bodyGyro.CFrame = workspace.CurrentCamera.CFrame
        bodyGyro.Parent = rootPart
        
        bodyVelocity = Instance.new("BodyVelocity")
        bodyVelocity.Velocity = Vector3.new(0, 0, 0)
        bodyVelocity.MaxForce = Vector3.new(10000, 10000, 10000)
        bodyVelocity.Parent = rootPart
        
        FlyButton.Text = "ВЫКЛЮЧИТЬ ПОЛЁТ"
        FlyButton.BackgroundColor3 = Color3.fromRGB(255, 80, 80)
        ShowNotification("Полёт включен (Скорость: "..flySpeed..")")
        isFlying = true
    else
        humanoid.PlatformStand = false
        if bodyGyro then bodyGyro:Destroy() end
        if bodyVelocity then bodyVelocity:Destroy() end
        
        FlyButton.Text = "ВКЛЮЧИТЬ ПОЛЁТ"
        FlyButton.BackgroundColor3 = Color3.fromRGB(80, 80, 255)
        ShowNotification("Полёт выключен")
        isFlying = false
    end
end

-- Функция для изменения скорости
local function ApplySpeed()
    local newSpeed = tonumber(SpeedBox.Text) or 50
    newSpeed = math.clamp(newSpeed, 1, 1000) -- Ограничиваем скорость от 1 до 1000
    
    flySpeed = newSpeed
    SpeedBox.Text = tostring(flySpeed)
    ShowNotification("Скорость установлена: "..flySpeed)
    
    if isFlying then
        ShowNotification("Полёт активен (Скорость: "..flySpeed..")")
    end
end

-- Улучшенная функция подсветки игроков
local function ToggleHighlight()
    isHighlighting = not isHighlighting
    
    if isHighlighting then
        HighlightButton.Text = "ОТКЛЮЧИТЬ ПОДСВЕТКУ"
        HighlightButton.BackgroundColor3 = Color3.fromRGB(80, 255, 80)
        ShowNotification("Подсветка игроков включена")
        
        -- Очищаем старые подсветки
        for _, highlight in pairs(highlights) do
            if highlight then highlight:Destroy() end
        end
        highlights = {}
        
        -- Подсвечиваем всех игроков
        for _, player in ipairs(game.Players:GetPlayers()) do
            if player ~= game.Players.LocalPlayer then
                -- Подсвечиваем текущий персонаж
                if player.Character then
                    AddHighlight(player)
                end
                
                -- Добавляем обработчик для нового персонажа
                local conn = player.CharacterAdded:Connect(function(char)
                    if isHighlighting then
                        AddHighlight(player)
                    end
                end)
                table.insert(connections, conn)
            end
        end
    else
        HighlightButton.Text = "ПОДСВЕТКА ИГРОКОВ"
        HighlightButton.BackgroundColor3 = Color3.fromRGB(255, 80, 80)
        ShowNotification("Подсветка игроков выключена")
        
        -- Удаляем все подсветки
        for _, highlight in pairs(highlights) do
            if highlight then highlight:Destroy() end
        end
        highlights = {}
    end
end

-- Функция добавления подсветки для игрока
local function AddHighlight(player)
    if not player or not player.Character then return end
    
    -- Удаляем старую подсветку если есть
    if highlights[player] then
        highlights[player]:Destroy()
    end
    
    local highlight = Instance.new("Highlight")
    highlight.FillColor = highlightColor
    highlight.OutlineColor = Color3.new(
        math.min(highlightColor.R * 1.5, 1),
        math.min(highlightColor.G * 1.5, 1),
        math.min(highlightColor.B * 1.5, 1)
    )
    highlight.Parent = player.Character
    highlights[player] = highlight
    
    -- Добавляем обработчик для частей персонажа
    local conn = player.Character.DescendantAdded:Connect(function(descendant)
        if descendant:IsA("BasePart") and highlights[player] then
            highlights[player].Parent = player.Character
        end
    end)
    table.insert(connections, conn)
end

-- Функция NoClip
local function ToggleNoClip()
    isNoClip = not isNoClip
    local character = game.Players.LocalPlayer.Character
    if not character then return end
    
    if isNoClip then
        NoClipButton.Text = "ВЫКЛЮЧИТЬ NOCLIP"
        NoClipButton.BackgroundColor3 = Color3.fromRGB(200, 100, 200)
        ShowNotification("NoClip включен")
        
        -- Делаем все части Non-Collidable
        for _, part in ipairs(character:GetDescendants()) do
            if part:IsA("BasePart") then
                part.CanCollide = false
            end
        end
        
        -- Добавляем обработчик для новых частей
        local conn = character.DescendantAdded:Connect(function(descendant)
            if descendant:IsA("BasePart") then
                descendant.CanCollide = false
            end
        end)
        table.insert(connections, conn)
    else
        NoClipButton.Text = "ВКЛЮЧИТЬ NOCLIP"
        NoClipButton.BackgroundColor3 = Color3.fromRGB(150, 50, 150)
        ShowNotification("NoClip выключен")
        
        -- Восстанавливаем Collision
        for _, part in ipairs(character:GetDescendants()) do
            if part:IsA("BasePart") then
                part.CanCollide = true
            end
        end
    end
end

-- Функция для применения цвета подсветки
local function ApplyHighlightColor()
    local r = tonumber(RBox.Text) or 255
    local g = tonumber(GBox.Text) or 50
    local b = tonumber(BBox.Text) or 50
    
    r = math.clamp(r, 0, 255)
    g = math.clamp(g, 0, 255)
    b = math.clamp(b, 0, 255)
    
    highlightColor = Color3.fromRGB(r, g, b)
    
    if isHighlighting then
        for player, highlight in pairs(highlights) do
            if highlight and player.Character then
                highlight.FillColor = highlightColor
                highlight.OutlineColor = Color3.new(
                    math.min(highlightColor.R * 1.5, 1),
                    math.min(highlightColor.G * 1.5, 1),
                    math.min(highlightColor.B * 1.5, 1)
                )
                highlight.Parent = player.Character
            end
        end
    end
    
    ShowNotification(string.format("Цвет изменён: %d, %d, %d", r, g, b))
end

-- Очистка всех соединений
local function CleanupConnections()
    for _, conn in ipairs(connections) do
        conn:Disconnect()
    end
    connections = {}
end

-- Обработчики кнопок
FlyButton.MouseButton1Click:Connect(ToggleFlight)
HighlightButton.MouseButton1Click:Connect(ToggleHighlight)
NoClipButton.MouseButton1Click:Connect(ToggleNoClip)
ApplyColorButton.MouseButton1Click:Connect(ApplyHighlightColor)
ApplySpeedButton.MouseButton1Click:Connect(ApplySpeed)

-- Обработчик для новых игроков
game.Players.PlayerAdded:Connect(function(player)
    if isHighlighting then
        local conn = player.CharacterAdded:Connect(function(char)
            AddHighlight(player)
        end)
        table.insert(connections, conn)
    end
end)

-- Управление полётом
local UserInputService = game:GetService("UserInputService")
local movingDirection = Vector3.new(0, 0, 0)

local function UpdateFlight(dt)
    if not isFlying then return end
    
    local character = game.Players.LocalPlayer.Character
    if not character then return end
    
    local rootPart = character:FindFirstChild("HumanoidRootPart")
    if not rootPart or not bodyGyro or not bodyVelocity then return end
    
    if movingDirection.Magnitude > 0 then
        local moveDirection = workspace.CurrentCamera.CFrame:VectorToWorldSpace(movingDirection)
        bodyVelocity.Velocity = moveDirection * flySpeed
        bodyGyro.CFrame = workspace.CurrentCamera.CFrame
    else
        bodyVelocity.Velocity = Vector3.new(0, 0, 0)
    end
end

-- Обработка ввода для полёта
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if not isFlying or gameProcessed then return end
    
    if input.KeyCode == Enum.KeyCode.W then
        movingDirection = movingDirection + Vector3.new(0, 0, -1)
    elseif input.KeyCode == Enum.KeyCode.S then
        movingDirection = movingDirection + Vector3.new(0, 0, 1)
    elseif input.KeyCode == Enum.KeyCode.D then
        movingDirection = movingDirection + Vector3.new(1, 0, 0)
    elseif input.KeyCode == Enum.KeyCode.A then
        movingDirection = movingDirection + Vector3.new(-1, 0, 0)
    elseif input.KeyCode == Enum.KeyCode.Space then
        movingDirection = movingDirection + Vector3.new(0, 1, 0)
    elseif input.KeyCode == Enum.KeyCode.LeftShift then
        movingDirection = movingDirection + Vector3.new(0, -1, 0)
    end
end)

UserInputService.InputEnded:Connect(function(input, gameProcessed)
    if not isFlying or gameProcessed then return end
    
    if input.KeyCode == Enum.KeyCode.W then
        movingDirection = movingDirection - Vector3.new(0, 0, -1)
    elseif input.KeyCode == Enum.KeyCode.S then
        movingDirection = movingDirection - Vector3.new(0, 0, 1)
    elseif input.KeyCode == Enum.KeyCode.D then
        movingDirection = movingDirection - Vector3.new(1, 0, 0)
    elseif input.KeyCode == Enum.KeyCode.A then
        movingDirection = movingDirection - Vector3.new(-1, 0, 0)
    elseif input.KeyCode == Enum.KeyCode.Space then
        movingDirection = movingDirection - Vector3.new(0, 1, 0)
    elseif input.KeyCode == Enum.KeyCode.LeftShift then
        movingDirection = movingDirection - Vector3.new(0, -1, 0)
    end
end)

-- Основной цикл
game:GetService("RunService").Heartbeat:Connect(function(dt)
    UpdateFlight(dt)
    
    -- Автоматическая очистка несуществующих подсветок
    if isHighlighting then
        for player, highlight in pairs(highlights) do
            if not player or not player.Character or not highlight then
                if highlight then highlight:Destroy() end
                highlights[player] = nil
            end
        end
    end
end)

-- Очистка при выходе
game.Players.LocalPlayer.CharacterRemoving:Connect(function()
    CleanupConnections()
end)
